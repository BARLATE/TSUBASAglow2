<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SOUTA育成RPG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Rounded+M+PLUS+1c&display=swap" rel="stylesheet">

  <style>
    body { margin:0; background:#000; color:#fff; font-family:'Rounded M PLUS 1c',sans-serif; }
    .menu { background:#111; color:#fff; display:flex; justify-content:space-around; padding:10px 0; font-weight:bold; }
    .menu a { text-decoration:none; color:#fff; padding:6px 12px; border-radius:12px; background:rgba(255,255,255,0.1); }
    .top-section { padding:20px 10px; text-align:center; }
    .title { font-size:32px; font-weight:bold; margin-bottom:10px; }
    .character-img { width:80vw; max-width:300px; border-radius:20px; box-shadow:0 0 12px #fff; transition:transform 0.5s ease; }
    .message { margin-top:10px; font-size:20px; }
    .level-info, .status { margin-top:8px; font-size:18px; }
    button { margin-top:15px; padding:16px 24px; font-size:20px; font-weight:bold; background-color:#fff; color:#000; border:none; border-radius:30px; width:90%; max-width:360px; }
    .exp-bar { width:90%; max-width:360px; height:20px; background:#fff; border-radius:10px; overflow:hidden; margin:10px auto; }
    .exp-fill { height:100%; background:#000; width:0%; transition:width 0.3s ease; }
  </style>

  <!-- ✅ カメラが動作するTSUBASA版と同じライブラリ記述 -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>
  <audio id="tapSound" src="tap.mp3" preload="auto"></audio>
  <audio id="levelUpSound" src="levelup.mp3" preload="auto"></audio>

  <div id="qr-reader" style="width:300px; margin:auto; display:none;"></div>

  <div class="menu">
    <a href="index.html">TSUBASA</a>
    <a href="kaede.html">KAEDE</a>
    <a href="momoa.html">MOMOA</a>
    <a href="souta.html">SOUTA</a>
  </div>

  <div class="top-section">
    <div class="title">SOUTAの育成中！</div>
    <img src="souta_lv1.png.PNG" alt="SOUTA" class="character-img" id="charImage">
    <div class="message" id="message">「静かにいこう。夜は長い。」</div>
    <div class="level-info" id="levelInfo">レベル: 1（経験値: 0/10）</div>
    <div class="status" id="status">攻撃力: 500 / 防御力: 500</div>
    <div class="exp-bar"><div class="exp-fill" id="expFill"></div></div>
    <button onclick="startQrScanner()">お酒をあげる</button>
    <button onclick="resetProgress()">リセットする</button>
  </div>

  <script>
    let level = parseInt(localStorage.getItem("souta_level")) || 1;
    let exp = parseInt(localStorage.getItem("souta_exp")) || 0;
    const maxExp = 10;

    const images = ["souta_lv1.png.PNG","souta_lv2.png.PNG","souta_lv3.png.PNG","souta_lv4.png.PNG","souta_lv5.png.PNG",
                    "souta_lv6.png.PNG","souta_lv7.png.PNG","souta_lv8.png.PNG","souta_lv9.png.PNG","souta_lv10.png.PNG"];
    const messages = ["静かにいこう。夜は長い。","氷、足そうか？ 黒で締める。","少しずつ、確実に。","観察は得意なんだ。",
                      "いい流れ来てる、感じるだろ？","任せて。落とさない。","もう迷わないよ。","月が綺麗。君もな。",
                      "この静けさ、悪くない。","SOUTA伝説、始動。"];

    function updateDisplay(){
      document.getElementById("charImage").src = images[level-1];
      document.getElementById("message").textContent = "「" + messages[level-1] + "」";
      document.getElementById("levelInfo").textContent = `レベル: ${level}（経験値: ${exp}/${maxExp}）`;
      document.getElementById("status").textContent = `攻撃力: ${level*500} / 防御力: ${level*500}`;
      document.getElementById("expFill").style.width = `${(exp/maxExp)*100}%`;
    }

    function giveDrink(){
      document.getElementById("tapSound").play();
      exp++;
      if(exp>=maxExp){
        exp=0;
        if(level<10){
          level++;
          document.getElementById("levelUpSound").play();
          alert("レベルアップ！SOUTAはLv"+level+"になった！");
        }
      }
      localStorage.setItem("souta_level",level);
      localStorage.setItem("souta_exp",exp);
      updateDisplay();
    }

    function resetProgress(){
      if(confirm("本当にリセットしますか？")){
        localStorage.removeItem("souta_level");
        localStorage.removeItem("souta_exp");
        level=1;exp=0;updateDisplay();
      }
    }

    // ✅ カメラ起動関数（TSUBASA版と同じ構成）
    function startQrScanner(){
      document.getElementById("qr-reader").style.display="block";
      const html5QrCode=new Html5Qrcode("qr-reader");
      html5QrCode.start(
        { facingMode:"environment" },
        { fps:10, qrbox:250 },
        qrCodeMessage=>{
          html5QrCode.stop().then(()=>{
            document.getElementById("qr-reader").style.display="none";
            if(qrCodeMessage==="SOUTA-OK"){
              giveDrink();
            }else{
              alert("このQRコードは無効です");
            }
          });
        },
        err=>{}
      ).catch(err=>{
        console.error("QR起動失敗:",err);
        alert("カメラを起動できません。ブラウザ設定を確認してください。");
      });
    }

    window.onload=updateDisplay;
  </script>
</body>
</html>